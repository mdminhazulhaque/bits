<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="theme-color" content="#000000">
  <meta name="msapplication-navbutton-color" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style" content="#000000">
  <meta name="description" content="Add Instruction Node

Every valid XML must contain processing instruction. XML is widely used for
HTML, SVG, XLS etc. So make sure your XML file has vali...">
  <meta name="author" content="Md. Minhazul Haque">
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Bits",
      "item": "https://bits.mdminhazulhaque.io/"
    },{
      "@type": "ListItem",
      "position": 2,
      "name": "qt",
      "item": "https://bits.mdminhazulhaque.io/qt"
    },{
      "@type": "ListItem",
      "position": 3,
      "name": "Some words about Qt DOM Node, Element and Attribute",
      "item": "https://bits.mdminhazulhaque.io//qt/some-words-about-qt-dom-node-element-and-attribute.html"
    }]
  }</script>
  <title>Some words about Qt DOM Node, Element and Attribute | Bits</title>
  <link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
  <link href="https://mdminhazulhaque.github.io/solaimanlipi/css/solaimanlipi.css" rel="stylesheet" type="text/css">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/print.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon.png">
  <link rel="icon" type="image/x-icon" href="/public/favicon.ico?v=20200507">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <style>.blink{animation:blink 1s infinite;}@keyframes blink{to{opacity:.0}}</style>
</head>

  <body>
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a class="monospace" href="/">
        Bits<span class="blink">_</span>
        </a>
      </h1>
      <p class="lead">Random posts written by <a href="https://mdminhazulhaque.io">Md. Minhazul Haque</a></p>
      <p>Find me at ...
      <br><a href="https://github.com/mdminhazulhaque"><i class="fa fa-fw fa-github"></i> Github</a>
      <br><a href="https://bd.linkedin.com/in/mdminhazulhaque"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
      <br><a href="https://stackexchange.com/users/1348058/md-minhazul-haque?tab=accounts"><i class="fa fa-fw fa-stack-exchange"></i> StackExchange</a>
      </p>
    </div>
    <p>&copy; 2012 - 2020. All rights reserved.</p>
  </div>
</div>

    <div class="content container">
      <div class="post">
  <h1 class="post-title">Some words about Qt DOM Node, Element and Attribute</h1>
  <hr>
  <i class="fa fa-fw fa-calendar"></i>03 Jan 2015 <i class="fa fa-fw fa-tag"></i><a href="/qt">qt</a>
  <hr>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <ins class="adsbygoogle"
       style="display:inline-block;width:728px;height:90px"
       data-ad-client="ca-pub-9642838276352812"
       data-ad-slot="2958174403"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <h2 id="add-instruction-node">Add Instruction Node</h2>

<p>Every valid XML must contain processing instruction. XML is widely used for
HTML, SVG, XLS etc. So make sure your XML file has valid instruction of its
type and encoding. The following line is a sample XML processing instruction.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
</code></pre></div></div>

<h2 id="skip-instruction-node-while-reading-xml">Skip Instruction Node While Reading XML</h2>

<p>I don’t know how you read XML nodes and values. Most examples out there use
parent and child counts. Obviously, DOM processing instruction is a node.
Let’s refer the following XML file.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">type=</span><span class="s">"user"</span><span class="nt">&gt;</span>minhaz<span class="nt">&lt;/node&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">type=</span><span class="s">"os"</span><span class="nt">&gt;</span>linux<span class="nt">&lt;/node&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">type=</span><span class="s">"version"</span><span class="nt">&gt;</span>3.2.0-37<span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<p>A valid XML must start with a root element. Here <code class="highlighter-rouge">properties</code> is a root
element. It has 3 child nodes. Each node has <code class="highlighter-rouge">node value</code> and
<strong>attribute</strong>. So how do we parse the whole XML? If we refer the whole
document as a node, then the first line, processing instruction, will be
regarded as a node. So properties will be the 2nd child node, but technically,
it is the first/root node. So instead of using
<code class="highlighter-rouge">document.childNodes().at(1)</code> method, we could use
<code class="highlighter-rouge">document.namedItem("properties")</code> to get list of all child nodes under
properties tag. Here is a sample code.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QDomDocument</span> <span class="n">document</span><span class="p">;</span>
<span class="n">document</span><span class="p">.</span><span class="n">setContent</span><span class="p">(</span><span class="n">xmlString</span><span class="p">);</span>
<span class="n">QDomNode</span> <span class="n">root</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">namedItem</span><span class="p">(</span><span class="s">"properties"</span><span class="p">);</span>
<span class="n">QDomNodeList</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">childNodes</span><span class="p">();</span>

<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nodes</span><span class="p">.</span><span class="n">count</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">qDebug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"Type: "</span> <span class="o">&lt;&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">toElement</span><span class="p">().</span><span class="n">attribute</span><span class="p">(</span><span class="s">"type"</span><span class="p">)</span>
        <span class="o">&lt;&lt;</span> <span class="s">" Value: "</span> <span class="o">&lt;&lt;</span> <span class="n">nodes</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">toElement</span><span class="p">().</span><span class="n">text</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And this will result into the following output.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">Type:</span>  <span class="s">"user"</span>  <span class="n">Value</span><span class="o">:</span>  <span class="s">"minhaz"</span> 
<span class="n">Type</span><span class="o">:</span>  <span class="s">"os"</span>  <span class="n">Value</span><span class="o">:</span>  <span class="s">"linux"</span> 
<span class="n">Type</span><span class="o">:</span>  <span class="s">"version"</span>  <span class="n">Value</span><span class="o">:</span>  <span class="s">"3.2.0-37"</span>
</code></pre></div></div>

<p>Any more confusion? Or a better method? Let me know.</p>

<h2 id="create-xml-and-write-into-file">Create XML and Write into File</h2>

<p>Parsing XML is easy. The structure is already preset there. Just detect the
hierarchy and parse. But what about creating your own? Perhaps from an user
defined directory tree? I went into this painful issue, and then found the
correct solution.</p>

<p>What if we try to generate an XML from the previous text output. Assume that
we have two string lists.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QStringList</span> <span class="n">attributeValues</span> <span class="o">=</span> <span class="n">QStringList</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"user"</span> <span class="o">&lt;&lt;</span> <span class="s">"os"</span> <span class="o">&lt;&lt;</span> <span class="s">"version"</span><span class="p">;</span>
<span class="n">QStringList</span> <span class="n">nodeValues</span> <span class="o">=</span> <span class="n">QStringList</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"minhaz"</span> <span class="o">&lt;&lt;</span> <span class="s">"linux"</span> <span class="o">&lt;&lt;</span> <span class="s">"3.2.0-37"</span><span class="p">;</span>
</code></pre></div></div>

<p>We need to create an XML using these strings, and with a processing
instruction. Lets get started.</p>

<p>First, create a DOM document. (Don’t blame me unless you added <code class="highlighter-rouge">qt += xml</code>
to your project file) Then declare a QDomDocument object.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QDomDocument</span> <span class="n">document</span><span class="p">;</span>
</code></pre></div></div>

<p>Now create a QDomProcessingInstruction object with correct encoding and XML
version. Then add it as child node of document.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QDomProcessingInstruction</span> <span class="n">header</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">createProcessingInstruction</span><span class="p">(</span><span class="s">"xml"</span><span class="p">,</span> <span class="s">"version=</span><span class="se">\"</span><span class="s">1.0</span><span class="se">\"</span><span class="s"> encoding=</span><span class="se">\"</span><span class="s">UTF-8</span><span class="se">\"</span><span class="s">"</span><span class="p">);</span>
<span class="n">document</span><span class="p">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">header</span><span class="p">);</span>
</code></pre></div></div>

<p>Now move to root node with tagname <code class="highlighter-rouge">properties</code>. Create a QDomElement
object and append it to root.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QDomElement</span> <span class="n">root</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">createElement</span><span class="p">(</span><span class="s">"properties"</span><span class="p">);</span>
<span class="n">document</span><span class="p">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</code></pre></div></div>

<p>Then we will add child nodes under <code class="highlighter-rouge">properties</code> tag. Most people might
think that the following line would add child nodes under root.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QDomNode</span> <span class="n">child</span><span class="p">;</span>
<span class="n">root</span><span class="p">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>NO! That is wrong</strong>. You must create every node or elements using the reference of document. Just keep in mind that there might be more than one documents in codes. So you should not mess with parents and childs. The following lines will generate child nodes under <code class="highlighter-rouge">properties</code> tag.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QDomElement</span> <span class="n">node</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">createElement</span><span class="p">(</span><span class="s">"node"</span><span class="p">);</span>
<span class="n">root</span><span class="p">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</code></pre></div></div>

<p>Did you spot the difference? You have to use <code class="highlighter-rouge">document.createElement</code>, not
root.appendChild method. As we have a list of strings, so we can use a loop to
create all nodes and set values to them.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">attributeValues</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QDomElement</span> <span class="n">node</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">createElement</span><span class="p">(</span><span class="s">"node"</span><span class="p">);</span>
    <span class="n">node</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span><span class="n">attributeValues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">root</span><span class="p">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>

    <span class="n">QDomText</span> <span class="n">value</span> <span class="o">=</span> <span class="n">document</span><span class="p">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="n">nodeValues</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">node</span><span class="p">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The code looks pretty clear. Create an element, set its attribute and append
it to root. The 2nd block is used to set the value of that node.</p>

<p>To write the XML into file, open a QFile object, open it and flush the
document onto it.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">QFile</span> <span class="nf">xml</span><span class="p">(</span><span class="s">"new-xml-file.xml"</span><span class="p">);</span>
<span class="n">xml</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">QIODevice</span><span class="o">::</span><span class="n">WriteOnly</span><span class="p">);</span>
<span class="n">xml</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">document</span><span class="p">.</span><span class="n">toByteArray</span><span class="p">());</span>
<span class="n">xml</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</code></pre></div></div>

<p>Here is the output.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">type=</span><span class="s">"user"</span><span class="nt">&gt;</span>minhaz<span class="nt">&lt;/node&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">type=</span><span class="s">"os"</span><span class="nt">&gt;</span>linux<span class="nt">&lt;/node&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">type=</span><span class="s">"version"</span><span class="nt">&gt;</span>3.2.0-37<span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<p>That is enough for basic XML r/w actions. If you want to learn more or go
deeper, run Qt Assistant. They have really awesome and detailed documents out
there.</p>

<p>Cheers!</p>

  <ins class="adsbygoogle"
       style="display:inline-block;width:728px;height:90px"
       data-ad-client="ca-pub-9642838276352812"
       data-ad-slot="7351100586"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://bitsfromminhaz.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


    </div>
  </body>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-57632461-7', 'auto');
  ga('send', 'pageview');
</script>
</html>
