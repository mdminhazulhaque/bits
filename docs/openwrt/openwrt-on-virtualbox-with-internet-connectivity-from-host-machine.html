<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="theme-color" content="#000000">
  <meta name="msapplication-navbutton-color" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style" content="#000000">
  <meta name="description" content="Last week I tried to run OpenWRT inside a VM and had a lot of troubles before being successful. So I thought that I should write a post about it.

First,...">
  <meta name="author" content="Md. Minhazul Haque">
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Bits",
      "item": "https://bits.mdminhazulhaque.io/"
    },{
      "@type": "ListItem",
      "position": 2,
      "name": "openwrt",
      "item": "https://bits.mdminhazulhaque.io/openwrt"
    },{
      "@type": "ListItem",
      "position": 3,
      "name": "OpenWRT inside VirtualBox with Internet Connectivity from Host Machine",
      "item": "https://bits.mdminhazulhaque.io//openwrt/openwrt-on-virtualbox-with-internet-connectivity-from-host-machine.html"
    }]
  }</script>
  <title>OpenWRT inside VirtualBox with Internet Connectivity from Host Machine | Bits</title>
  <link href="https://fonts.googleapis.com/css?family=Merriweather|Inconsolata" rel="stylesheet">
  <link href="https://mdminhazulhaque.github.io/solaimanlipi/css/solaimanlipi.css" rel="stylesheet" type="text/css">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/print.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon.png">
  <link rel="icon" type="image/x-icon" href="/public/favicon.ico?v=20190712">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <style>.blink{animation:blink 1s infinite;}@keyframes blink{to{opacity:.0}}a.monospace{font-family:Inconsolata;}</style>
</head>

  <body>
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a class="monospace" href="/">
        Bits<span class="blink">_</span>
        </a>
      </h1>
      <p class="lead">Random posts written by <a href="https://mdminhazulhaque.io">Md. Minhazul Haque</a></p>
      <p>Find me at ...
      <br><a href="https://github.com/mdminhazulhaque"><i class="fa fa-fw fa-github"></i> Github</a>
      <br><a href="https://stackexchange.com/users/1348058/md-minhazul-haque?tab=accounts"><i class="fa fa-fw fa-stack-exchange"></i> StackExchange</a>
      <br><a href="https://bd.linkedin.com/in/mdminhazulhaque"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
      <br><a href="https://twitter.com/mdminhazulhaque"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
      <br><a href="https://www.instagram.com/md.minhazul.haque/"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
      </p>
    </div>
    <p>&copy; 2012 - 2019. All rights reserved.</p>
  </div>
</div>

    <div class="content container">
      <div class="post">
  <h1 class="post-title">OpenWRT inside VirtualBox with Internet Connectivity from Host Machine</h1>
  <hr>
  <i class="fa fa-fw fa-calendar"></i>26 Nov 2016 <i class="fa fa-fw fa-tag"></i><a href="/openwrt">openwrt</a>
  <hr>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <ins class="adsbygoogle"
       style="display:inline-block;width:728px;height:90px"
       data-ad-client="ca-pub-9642838276352812"
       data-ad-slot="2958174403"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <p>Last week I tried to run OpenWRT inside a VM and had a lot of troubles before being successful. So I thought that I should write a post about it.</p>

<p>First, you will need a virtualization software, VirtualBox seems to be a perfect fit for such purpose. Then you will need a ext4 disk image of OpenWRT with x86-64 support because VirtualBox supports no other architectures other than x86/x64. The latest image can be downloaded from this link.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://downloads.openwrt.org/snapshots/trunk/x86/64/openwrt-x86-64-combined-ext4.img.gz
</code></pre></div></div>

<p>After downloading the compressed gzipped image, let’s convert it into raw disk image and then into VirtualBox compatible VDI image.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">gunzip </span>openwrt-x86-64-combined-ext4.img.gz
VBoxManage convertfromraw <span class="nt">--format</span> VDI openwrt-x86-64-combined-ext4.img openwrt-x86-64-combined-ext4.vdi
</code></pre></div></div>

<p>Now let’s create an OpenWRT VM with the previously converted VDI image. The following script does the trick in 1s.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">VMNAME</span><span class="o">=</span><span class="s2">"openwrt"</span>
<span class="nv">VDI</span><span class="o">=</span><span class="s2">"/home/minhaz/openwrt-x86-64-combined-ext4.vdi"</span> <span class="c"># change here</span>

VBoxManage createvm <span class="nt">--name</span> <span class="nv">$VMNAME</span> <span class="nt">--register</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
VBoxManage modifyvm <span class="nv">$VMNAME</span> <span class="se">\</span>
    <span class="nt">--description</span> <span class="s2">"An OpenWRT VM"</span> <span class="se">\</span>
    <span class="nt">--ostype</span> <span class="s2">"Linux_64"</span> <span class="se">\</span>
    <span class="nt">--memory</span> <span class="s2">"256"</span> <span class="se">\</span>
    <span class="nt">--cpus</span> <span class="s2">"1"</span> <span class="se">\</span>
    <span class="nt">--nic1</span> <span class="s2">"intnet"</span> <span class="se">\</span>
    <span class="nt">--nictype1</span> <span class="s2">"82540EM"</span> <span class="se">\</span>
    <span class="nt">--nic2</span> <span class="s2">"nat"</span> <span class="se">\</span>
    <span class="nt">--nictype2</span> <span class="s2">"82540EM"</span> <span class="se">\</span>
    <span class="nt">--natpf2</span> <span class="s2">"ssh,tcp,,2222,,22"</span> <span class="se">\</span>
    <span class="nt">--natpf2</span> <span class="s2">"luci,tcp,,8080,,80"</span> <span class="se">\</span>
    <span class="nt">--natpf2</span> <span class="s2">"ftp,tcp,,2121,,21"</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
VBoxManage storagectl <span class="nv">$VMNAME</span> <span class="se">\</span>
    <span class="nt">--name</span> <span class="s2">"SATA Controller"</span> <span class="se">\</span>
    <span class="nt">--add</span> <span class="s2">"sata"</span> <span class="se">\</span>
    <span class="nt">--portcount</span> <span class="s2">"1"</span> <span class="se">\</span>
    <span class="nt">--hostiocache</span> <span class="s2">"on"</span> <span class="se">\</span>
    <span class="nt">--bootable</span> <span class="s2">"on"</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
VBoxManage storageattach <span class="nv">$VMNAME</span> <span class="se">\</span>
    <span class="nt">--storagectl</span> <span class="s2">"SATA Controller"</span> <span class="se">\</span>
    <span class="nt">--port</span> <span class="s2">"1"</span> <span class="se">\</span>
    <span class="nt">--type</span> <span class="s2">"hdd"</span> <span class="se">\</span>
    <span class="nt">--nonrotational</span> <span class="s2">"on"</span> <span class="se">\</span>
    <span class="nt">--medium</span> <span class="nv">$VDI</span>
</code></pre></div></div>

<p>Note that, I have set the NIC type to 82540EM which works automatically with OpenWRT modules. So whenever you boot OpenWRT, it will automatically detect NIC2 as WAN. This will allow you to ping google.com, update opkg and install packages too.</p>

<p>As you can see, I have forwarded port 21, 22 and 80 to the host machine. You might need to disable or modify the firewall configuration of the OpenWRT instance.</p>

<p>You can access LUCI of the instance by browsing to <code class="highlighter-rouge">http://localhost:8080</code> and SSH into it by <code class="highlighter-rouge">ssh root@localhost -p 2222</code>.</p>

<p>I hope that helps.</p>

  <ins class="adsbygoogle"
       style="display:inline-block;width:728px;height:90px"
       data-ad-client="ca-pub-9642838276352812"
       data-ad-slot="7351100586"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://bitsfromminhaz.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


    </div>
  </body>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-57632461-7', 'auto');
  ga('send', 'pageview');
</script>
</html>
